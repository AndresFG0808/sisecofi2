# üö® PROTOCOLO CR√çTICO - GESTI√ìN DE IM√ÅGENES EN HALLAZGOS üö®

‚ö†Ô∏è **IMPORTANTE**: Este proceso debe generar reportes JSON siguiendo:  
üìã **`EspecificacionReporteJSON.txt`** - Formato est√°ndar para todos los reportes

## ‚ö†Ô∏è ADVERTENCIA FUNDAMENTAL ‚ö†Ô∏è

**TODAS las im√°genes que proporcione el usuario durante cualquier proceso de reporte de hallazgos DEBEN ser procesadas, analizadas y agregadas obligatoriamente al hallazgo correspondiente.**

**NO ES OPCIONAL - ES OBLIGATORIO**

## PROTOCOLO PASO A PASO

### 1. DETECCI√ìN DE IM√ÅGENES
**AL INICIO DE CADA CONVERSACI√ìN:**
- Verificar si el usuario ha adjuntado o referenciado im√°genes
- Listar todas las im√°genes disponibles (nombres, rutas, formatos)
- Crear inventario completo de material visual proporcionado

### 2. AN√ÅLISIS VISUAL OBLIGATORIO
**PARA CADA IMAGEN:**
- **EXAMINAR:** ¬øQu√© muestra la imagen? (pantalla, formulario, tabla, error, etc.)
- **IDENTIFICAR:** ¬øQu√© m√≥dulo/funcionalidad se visualiza?
- **DETECTAR:** ¬øQu√© problema o discrepancia muestra la imagen?
- **CLASIFICAR:** ¬øCorresponde a ECU, EIU o ambos?
  - **ECU:** Muestra l√≥gica de negocio, flujos, pasos, mensajes de error, reglas de negocio, c√°lculos, validaciones
  - **EIU:** Muestra interfaz de usuario, campos, etiquetas, botones, dise√±o visual, elementos gr√°ficos
  - **Compartida:** Aplica a ambos SOLO si evidencia problemas tanto de l√≥gica como de interfaz
- **CORRELACIONAR:** ¬øA qu√© hallazgo espec√≠fico corresponde esta evidencia?

**IMPORTANTE:** NO duplicar autom√°ticamente en ECU y EIU. Analizar cada imagen y asignar solo donde corresponda.

### 3. CATALOGACI√ìN T√âCNICA
**INFORMACI√ìN A EXTRAER:**
- Nombre del archivo de imagen
- Ruta completa en el sistema
- Contenido visual (descripci√≥n t√©cnica)
- Relaci√≥n con hallazgo espec√≠fico (ECU o EIU)
- Elementos clave visibles (campos, botones, mensajes, datos)

### 4. INTEGRACI√ìN AL HALLAZGO
**EN EL JSON - CAMPO `imagenReferencia`:**
```json
"imagenReferencia": {
  "cantidad": [N√öMERO_REAL_DE_IM√ÅGENES],
  "rutas": [
    "C:\\ruta\\completa\\imagen1.png",
    "C:\\ruta\\completa\\imagen2.png"
  ]
}
```

### 5. VALIDACI√ìN FINAL
**CHECKPOINTS OBLIGATORIOS:**
- ‚úÖ Cantidad de im√°genes = n√∫mero de rutas en el array
- ‚úÖ Todas las rutas son completas y correctas
- ‚úÖ Cada imagen est√° asignada al hallazgo correcto
- ‚úÖ No hay im√°genes sin procesar
- ‚úÖ No hay hallazgos con im√°genes faltantes

## CASOS ESPEC√çFICOS

### IM√ÅGENES M√öLTIPLES PARA UN HALLAZGO
Si un hallazgo tiene varias im√°genes de evidencia:
```json
"imagenReferencia": {
  "cantidad": 3,
  "rutas": [
    "C:\\sisecofi\\docs_sisecofi\\img\\evidencia1.png",
    "C:\\sisecofi\\docs_sisecofi\\img\\evidencia2.png", 
    "C:\\sisecofi\\docs_sisecofi\\img\\evidencia3.png"
  ]
}
```

### IM√ÅGENES DISTRIBUIDAS ENTRE ECU Y EIU
**AN√ÅLISIS ESPEC√çFICO POR CONTENIDO:**
- **Asignar a ECU:** Im√°genes que muestran l√≥gica/flujo/reglas de negocio/c√°lculos/errores de sistema
- **Asignar a EIU:** Im√°genes que muestran interfaz/campos/formularios/dise√±o visual/elementos gr√°ficos
- **Compartir SOLO cuando necesario:** Si una imagen evidencia problemas tanto de l√≥gica como de interfaz

**EJEMPLO DE DISTRIBUCI√ìN:**
- Imagen de c√≥digo/respuesta JSON ‚Üí ECU
- Imagen de pantalla con campos ‚Üí EIU  
- Imagen de documentaci√≥n t√©cnica ‚Üí ECU
- Imagen mostrando error en pantalla ‚Üí Puede ser ambos (analizar contexto)

### SIN IM√ÅGENES DISPONIBLES
Solo cuando NO hay im√°genes proporcionadas:
```json
"imagenReferencia": {
  "cantidad": 0,
  "rutas": []
}
```

## ERRORES CR√çTICOS A EVITAR

### ‚ùå ERROR GRAVE: Ignorar im√°genes proporcionadas
- **NUNCA** dejar `cantidad: 0` cuando hay im√°genes disponibles
- **SIEMPRE** procesar todas las im√°genes del usuario

### ‚ùå ERROR GRAVE: Rutas incorrectas  
- Verificar que las rutas sean completas y v√°lidas
- Usar el formato correcto de Windows: `C:\\ruta\\archivo.png`

### ‚ùå ERROR GRAVE: Asignaci√≥n incorrecta
- No asumir a qu√© hallazgo corresponde una imagen
- Analizar el contenido visual para determinar la correlaci√≥n correcta

### ‚ùå ERROR GRAVE: N√∫meros inconsistentes
- `cantidad` debe coincidir EXACTAMENTE con n√∫mero de elementos en `rutas`

## FORMATO DE RUTAS

### ESTRUCTURA EST√ÅNDAR:
```
C:\sisecofi\docs_sisecofi\img\[nombre_archivo]
```

### EJEMPLOS V√ÅLIDOS:
- `C:\\sisecofi\\docs_sisecofi\\img\\capture_251111_131421.png`
- `C:\\sisecofi\\docs_sisecofi\\img\\hallazgo_1_pantalla_principal.png`
- `C:\\sisecofi\\docs_sisecofi\\img\\error_validacion_campos.jpg`

## INTEGRACI√ìN CON EXCEL

**IMPORTANTE:** Al sincronizar con Excel, las im√°genes se insertan autom√°ticamente como objetos reales en las celdas correspondientes.

**El sistema:**
- Lee las rutas del JSON
- Procesa cada imagen como buffer
- Inserta la imagen real en la celda de Excel
- Mantiene proporci√≥n y calidad visual

## AN√ÅLISIS DE IM√ÅGENES PROPORCIONADAS

### IM√ÅGENES RECIBIDAS EN ESTA CONVERSACI√ìN:
1. **Primera imagen**: Documentaci√≥n ECU mostrando "Cantidad de servicios dictaminados acumulados" 
2. **Segunda imagen**: C√≥digo JSON mostrando campos con diferentes precisiones decimales

### AN√ÅLISIS VISUAL:
1. **Primera imagen (ECU)**:
   - Muestra documentaci√≥n oficial del paso de c√°lculo autom√°tico
   - Evidencia la regla RNA121 para c√°lculos de servicios
   - Corresponde a hallazgo ECU (l√≥gica de negocio)

2. **Segunda imagen (JSON)**:
   - Muestra datos con cantidadServiciosSat y cantidadServiciosCc con 6 decimales
   - Muestra cantidadTotalServicios con diferente precisi√≥n
   - Evidencia la inconsistencia en la presentaci√≥n de datos
   - Corresponde tanto a ECU (c√°lculo) como a EIU (visualizaci√≥n)

## RESPONSABILIDADES

### DEL ASISTENTE (OBLIGATORIO):
1. Detectar todas las im√°genes proporcionadas
2. Analizar contenido visual de cada imagen  
3. Correlacionar im√°genes con hallazgos espec√≠ficos
4. Agregar rutas completas al JSON
5. Validar consistencia cantidad vs rutas
6. Verificar que no se pierdan evidencias visuales

### DEL USUARIO:
1. Proporcionar im√°genes claras y relevantes
2. Indicar si las im√°genes corresponden a hallazgos espec√≠ficos
3. Confirmar que las rutas de archivos son correctas

## MENSAJE DE CONFIRMACI√ìN

Al finalizar el procesamiento de im√°genes, SIEMPRE incluir:

```
‚úÖ IM√ÅGENES PROCESADAS:
- Total de im√°genes recibidas: [X]
- Im√°genes asignadas a ECU: [X] 
- Im√°genes asignadas a EIU: [X]
- Todas las evidencias visuales han sido integradas correctamente al hallazgo correspondiente.
```

## RECORDATORIO FINAL

**Las im√°genes son EVIDENCIA CR√çTICA del hallazgo reportado.**  
**Omitirlas equivale a perder la prueba visual del problema.**  
**Su procesamiento NO ES OPCIONAL - ES OBLIGATORIO.**

## APLICACI√ìN A ESTE HALLAZGO

### ‚úÖ CONFIRMACI√ìN DE PROCESAMIENTO:

**Total de im√°genes recibidas: 2**
- Im√°genes asignadas a hallazgo ECU: 2 
- Im√°genes asignadas a hallazgo EIU: 2
- Todas las evidencias visuales han sido integradas correctamente al hallazgo #1

**Rutas asignadas:**
1. `C:\\sisecofi\\docs_sisecofi\\img\\capture_251111_131421.png`
2. `C:\\sisecofi\\docs_sisecofi\\img\\capture_251111_133024.png`

**Evidencia documentada:**
- ‚úÖ Documentaci√≥n ECU del RNA121
- ‚úÖ C√≥digo JSON mostrando inconsistencia decimal
- ‚úÖ Ambas im√°genes integradas en hallazgo ECU y EIU
